<!DOCTYPE html>
<html>
<head>
  <title>Drone Flight Planner</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden; /* Prevent scrollbars */
    }

    #container {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
    }

    #myImage {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain; /* Fit image while maintaining aspect ratio */
    }

    #bbox {
      position: absolute;
      border: 2px solid red;
      box-sizing: border-box;
    }
  </style>
</head>
<body>

<h1>Drone Flight Planner</h1>

<input type="file" id="imageUpload" accept="image/*">
<br>
<label for="coords">Bounding Box Coordinates [ymin, xmin, ymax, xmax] (0–1000):</label>
<input type="text" id="coords" value="400, 650, 850, 900">
<button id="drawButton">Draw Bounding Box</button>

<div id="container">
  <img id="myImage" src="#" alt="Uploaded Image">
  <div id="bbox"></div>
</div>

<script>
  const imageUpload = document.getElementById('imageUpload');
  const coordsInput = document.getElementById('coords');
  const drawButton = document.getElementById('drawButton');
  const myImage = document.getElementById('myImage');
  const bbox = document.getElementById('bbox');
  const container = document.getElementById('container');

  let imageLoaded = false;

  imageUpload.addEventListener('change', function (e) {
    const reader = new FileReader();
    reader.onload = function (event) {
      myImage.src = event.target.result;
      myImage.onload = () => {
        imageLoaded = true;
        drawBoundingBoxFromInput();
      }
    }
    reader.readAsDataURL(e.target.files[0]);
  });

  drawButton.addEventListener('click', drawBoundingBoxFromInput);
  window.addEventListener('resize', drawBoundingBoxFromInput);

  function drawBoundingBoxFromInput() {
    if (!imageLoaded) return;
    const coords = coordsInput.value.split(',').map(Number);
    if (coords.length === 4) {
      drawBoundingBox(coords);
    } else {
      alert('Please enter valid coordinates in the format [ymin, xmin, ymax, xmax] (0–1000).');
    }
  }

  function drawBoundingBox(coords) {
    const naturalWidth = myImage.naturalWidth;
    const naturalHeight = myImage.naturalHeight;
    const containerWidth = container.offsetWidth;
    const containerHeight = container.offsetHeight;

    // Determine the limiting dimension (width or height)
    const isWidthLimited = (naturalWidth / naturalHeight) > (containerWidth / containerHeight);

    // Calculate scale based on the limiting dimension
    let scale;
    if (isWidthLimited) {
      scale = containerWidth / naturalWidth;
    } else {
      scale = containerHeight / naturalHeight;
    }

    // Calculate the displayed dimensions of the image
    const displayedWidth = naturalWidth * scale;
    const displayedHeight = naturalHeight * scale;

    // Calculate offsets to center the image
    const offsetX = (containerWidth - displayedWidth) / 2;
    const offsetY = (containerHeight - displayedHeight) / 2;

    // Convert Gemini's [0–1000] coordinates back to normalized [0–1]
    // [ymin, xmin, ymax, xmax]
    const ymin = coords[0] / 1000;
    const xmin = coords[1] / 1000;
    const ymax = coords[2] / 1000;
    const xmax = coords[3] / 1000;

    // Calculate bounding box position and size
    const bboxTop = ymin * naturalHeight * scale + offsetY;
    const bboxLeft = xmin * naturalWidth * scale + offsetX;
    const bboxHeight = (ymax - ymin) * naturalHeight * scale;
    const bboxWidth = (xmax - xmin) * naturalWidth * scale;

    // Apply styles to bounding box
    bbox.style.top = bboxTop + 'px';
    bbox.style.left = bboxLeft + 'px';
    bbox.style.height = bboxHeight + 'px';
    bbox.style.width = bboxWidth + 'px';
  }
</script>

</body>
</html>
